<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>B·∫¢NG CH·∫§M C√îNG C√Å NH√ÇN - 2026</title>

    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2563eb">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- iOS Specific -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ch·∫•m C√¥ng">
    <link rel="apple-touch-icon" href="logo.jpg">
    <meta name="apple-touch-fullscreen" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-orientations" content="portrait-any">

    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Outfit:wght@500;700&display=swap"
        rel="stylesheet">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js')
                    .then(reg => {
                        console.log('Service Worker registered');

                        // Check for updates
                        reg.addEventListener('updatefound', () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New content is available, force reload
                                    console.log('New content available, reloading...');
                                    window.location.reload();
                                }
                            });
                        });
                    })
                    .catch(err => console.log('Service Worker registration failed', err));
            });

            // Ensure the page reloads if the service worker takes control
            let refreshing = false;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    window.location.reload();
                    refreshing = true;
                }
            });
        }
    </script>
</head>

<body>
    <div class="app-container">
        <header>
            <div class="header-left">
                <img src="logo.jpg" alt="Logo" class="app-logo">
                <h1 class="app-title">B·∫¢NG CH·∫§M C√îNG KHOA PT - GMHS</h1>
            </div>

            <div class="header-right">
                <div class="user-info-group">
                    <div id="status-indicator" class="status-indicator online" title="ƒêang tr·ª±c tuy·∫øn"></div>
                    <span id="current-user-display" class="user-name"></span>

                    <!-- GitHub Sync Status -->
                    <div class="sync-status-container" title="Tr·∫°ng th√°i ƒë·ªìng b·ªô GitHub">
                        <span id="sync-status-indicator" class="sync-status-indicator disabled">‚óã</span>
                        <span id="sync-status-text" class="sync-status-text">Ch∆∞a c·∫•u h√¨nh</span>
                    </div>

                    <button id="github-config-btn" class="help-button" title="C·∫•u h√¨nh GitHub" style="display: none;">
                        <span class="help-icon">‚òÅÔ∏è</span>
                    </button>
                    <button id="help-btn" class="help-button" title="H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng">
                        <span class="help-icon">?</span>
                    </button>
                    <button id="logout-btn" class="btn btn-logout" style="display:none;">ƒêƒÉng xu·∫•t</button>
                </div>

                <div class="controls-group">
                    <input type="month" id="month-picker" class="month-input">
                    <div class="btn-group">
                        <button id="save-btn" class="btn btn-save" title="L∆∞u d·ªØ li·ªáu">üíæ L∆∞u</button>
                        <button id="export-btn" class="btn btn-export" title="Xu·∫•t Excel">üìä Xu·∫•t</button>
                        <button id="print-btn" class="btn btn-print" title="In b√°o c√°o">üñ®Ô∏è In</button>
                        <button id="clear-btn" class="btn btn-clear" title="X√≥a h·∫øt">‚úï X√≥a</button>
                    </div>
                </div>
            </div>
        </header>

        <section class="employee-info">
            <div class="info-group-row">
                <div class="info-group">
                    <label>H·ªå V√Ä T√äN:</label>
                    <input type="text" id="employee-name" list="employee-names-list"
                        placeholder="Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß h·ªç v√† t√™n..." autocomplete="off">
                    <datalist id="employee-names-list">
                        <!-- Name suggestions will be populated by JavaScript -->
                    </datalist>
                </div>
                <div class="info-group">
                    <label>CH·ª®C V·ª§:</label>
                    <select id="employee-position">
                        <option value="ƒêI·ªÄU D∆Ø·ª†NG D·ª§NG C·ª§">ƒêI·ªÄU D∆Ø·ª†NG D·ª§NG C·ª§</option>
                        <option value="ƒêI·ªÄU D∆Ø·ª†NG H·ªíI S·ª®C">ƒêI·ªÄU D∆Ø·ª†NG H·ªíI S·ª®C</option>
                        <option value="KTV G√ÇY M√ä">KTV G√ÇY M√ä</option>
                        <option value="PH·ª§ TR√ÅCH KHO">PH·ª§ TR√ÅCH KHO</option>
                        <option value="TH∆Ø K√ç Y KHOA">TH∆Ø K√ç Y KHOA</option>
                        <option value="H·ªò L√ù">H·ªò L√ù</option>
                    </select>
                </div>
            </div>
        </section>

        <main class="table-wrapper">
            <table id="attendance-table">
                <thead>
                    <tr id="header-row">
                        <th class="sticky-col">NG√ÄY</th>
                        <!-- Dates will be injected here -->
                    </tr>
                </thead>
                <tbody>
                    <tr id="regular-row">
                        <td class="sticky-col label-cell">TRONG GI·ªú</td>
                        <!-- Regular hours inputs will be injected here -->
                    </tr>
                    <tr id="overtime-row">
                        <td class="sticky-col label-cell">NGO√ÄI GI·ªú</td>
                        <!-- Multi-line overtime inputs will be injected here -->
                    </tr>
                    <tr id="duty-row">
                        <td class="sticky-col label-cell">C·∫§U H√åNH TR·ª∞C</td>
                        <!-- Main duty checkboxes will be injected here -->
                    </tr>
                    <tr id="calculated-overtime-row">
                        <td class="sticky-col label-cell">T·ªïng c·ªông Ngo√†i gi·ªù (x H·ªá s·ªë)</td>
                        <!-- Daily calculated overtime totals will be injected here -->
                    </tr>
                </tbody>
            </table>
        </main>

        <div class="totals-section">
            <div class="total-card regular-card">
                <span class="total-label">T·ªïng c·ªông Trong gi·ªù:</span>
                <span id="total-regular" class="total-value">0</span>
            </div>
            <div class="total-card overtime-card">
                <span class="total-label">T·ªîNG C·ªòNG NGO√ÄI GI·ªú:</span>
                <span id="total-overtime" class="total-value">0</span>
            </div>
            <div class="total-card highlight-card">
                <span class="total-label">T·ªîNG C·ªòNG TH·ª∞C NH·∫¨N:</span>
                <span id="total-all" class="total-value">0</span>
            </div>
        </div>

        <section class="summary-section" id="summary-section">
            <div class="section-header">
                <h2 class="section-title">DANH S√ÅCH NH√ÇN VI√äN</h2>
                <div class="summary-controls">
                    <div id="admin-data-controls" style="display: none; align-items: center; gap: 8px;">
                        <button id="backup-btn" class="btn btn-backup" title="Sao l∆∞u to√†n b·ªô d·ªØ li·ªáu ra file .json">
                            üì• SAO L∆ØU
                        </button>
                        <button id="restore-btn" class="btn btn-restore" title="Kh√¥i ph·ª•c d·ªØ li·ªáu t·ª´ file .json">
                            üì§ KH√îI PH·ª§C
                        </button>
                        <input type="file" id="restore-input" style="display: none;" accept=".json">
                    </div>
                    <button id="refresh-summary" class="btn btn-print">L√†m m·ªõi b·∫£ng</button>
                </div>
            </div>
            <div class="table-wrapper">
                <table id="summary-table">
                    <thead>
                        <tr>
                            <th class="summary-sticky-stt">STT</th>
                            <th class="summary-sticky-name">H·ªå V√Ä T√äN</th>
                            <th>CH·ª®C V·ª§</th>
                            <th>TRONG GI·ªú</th>
                            <th>NGO√ÄI GI·ªú (xHS)</th>
                            <th>H·ªÜ S·ªê</th>
                            <th>T·ªîNG C·ªòNG</th>
                            <th id="summary-actions-header">THAO T√ÅC</th>
                        </tr>
                    </thead>
                    <tbody id="summary-body">
                        <!-- Summary data will be injected here -->
                    </tbody>
                </table>
            </div>
        </section>

        <footer>
            <div class="signature-section">
                <div class="signature-box">
                    <p id="display-sig-date"></p>
                    <p class="signature-title">NG∆Ø·ªúI L·∫¨P B·∫¢NG</p>
                    <p class="signature-name" id="signature-name"></p>
                </div>
            </div>

            <div class="dev-info">
                <p>Ph√°t tri·ªÉn b·ªüi <a href="tel:0367287102" class="zalo-link">T√¢n Nguy·ªÖn (036.728.7102)</a></p>
                <p class="slogan">"Code m·ªôt l·∫ßn- D√πng m·ªôt ƒë·ªùi"</p>
                <p class="version-info">Version 3.8 (Updated: 05.02.2026 - iOS Optimized)</p>
            </div>
        </footer>



        <!-- Help Guide Panel -->
        <div id="help-panel" class="help-panel">
            <div class="help-header">
                <h2>üìñ H∆Ø·ªöNG D·∫™N S·ª¨ D·ª§NG</h2>
                <button id="close-help-btn" class="close-help-btn">‚úï</button>
            </div>
            <div class="help-content">
                <section>
                    <h3>B∆∞·ªõc 1: ƒêƒÇNG NH·∫¨P üîê</h3>
                    <p>ƒê·ªÉ s·ª≠ d·ª•ng b·∫£ng ch·∫•m c√¥ng, anh/ch·ªã c·∫ßn ƒëƒÉng nh·∫≠p:</p>
                    <ul>
                        <li>üëâ <strong>T√™n ƒëƒÉng nh·∫≠p:</strong> Vi·∫øt <strong>T√äN</strong> c·ªßa m√¨nh (vi·∫øt HOA).<br>
                            <em>L∆∞u √Ω: N·∫øu tr√πng t√™n (nh∆∞ Nga, Thanh, Th·∫£o, Ng·ªçc) th√¨ ph·∫£i nh·∫≠p <strong>ƒê·∫¶Y ƒê·ª¶ H·ªå T√äN C√ì
                                    D·∫§U</strong>.</em>
                        </li>
                        <li>üëâ <strong>M·∫≠t kh·∫©u:</strong> Nh·∫≠p s·ªë <strong>123456</strong></li>
                    </ul>
                </section>

                <section>
                    <h3>B∆∞·ªõc 2: CH·ªåN TH√ÅNG C·∫¶N CH·∫§M üìÖ</h3>
                    <p>Nh√¨n l√™n g√≥c tr√™n, b√™n ph·∫£i m√†n h√¨nh c√≥ √¥ ch·ªçn th√°ng.</p>
                    <p>üëâ Anh/ch·ªã b·∫•m v√†o ƒë√≥ ƒë·ªÉ ch·ªçn th√°ng m√¨nh mu·ªën ch·∫•m c√¥ng.</p>
                </section>

                <section>
                    <h3>B∆∞·ªõc 3: NH·∫¨P GI·ªú L√ÄM VI·ªÜC ‚úçÔ∏è</h3>
                    <p><strong>1. C·ªôt TRONG GI·ªú:</strong></p>
                    <ul>
                        <li>Nh·∫≠p s·ªë gi·ªù l√†m h√†nh ch√≠nh c·ªßa ng√†y h√¥m ƒë√≥.</li>
                        <li>V√≠ d·ª•: L√†m c·∫£ ng√†y th√¨ nh·∫≠p s·ªë <strong>8</strong>.</li>
                    </ul>
                    <p><strong>2. C·ªôt NGO√ÄI GI·ªú:</strong> (D√†nh cho l√†m th√™m)</p>
                    <ul>
                        <li>C√°ch 1: Nh·∫≠p s·ªë ti·∫øng l√†m th√™m. V√≠ d·ª•: <strong>4</strong></li>
                        <li>C√°ch 2: Nh·∫≠p gi·ªù b·∫Øt ƒë·∫ßu v√† k·∫øt th√∫c. V√≠ d·ª•: <strong>17h-21h</strong></li>
                        <li>N·∫øu l√†m ƒë√™m: Nh·∫≠p <strong>22h30-2h30</strong></li>
                    </ul>
                    <p><strong>3. C·ªôt C·∫§U H√åNH TR·ª∞C:</strong></p>
                    <ul>
                        <li>B·∫•m v√†o √¥ ƒë√≥, n√≥ s·∫Ω hi·ªán ra danh s√°ch.</li>
                        <li>Ch·ªçn lo·∫°i tr·ª±c ph√π h·ª£p (V√≠ d·ª•: TR·ª∞C CH√çNH).</li>
                    </ul>
                </section>

                <section>
                    <h3>B∆∞·ªõc 4: L∆ØU L·∫†I üíæ</h3>
                    <p>‚ö†Ô∏è Quan tr·ªçng: Sau khi nh·∫≠p xong, anh/ch·ªã nh·ªõ b·∫•m n√∫t m√†u xanh <strong>"L∆∞u d·ªØ li·ªáu"</strong> ·ªü
                        tr√™n c√πng nh√©.</p>
                    <p>N·∫øu kh√¥ng b·∫•m L∆∞u, d·ªØ li·ªáu s·∫Ω b·ªã m·∫•t!</p>
                </section>

                <section>
                    <h3>B∆∞·ªõc 5: L∆ØU ONLINE (GITHUB) ‚òÅÔ∏è</h3>
                    <p>ƒê·ªÉ l∆∞u d·ªØ li·ªáu l√™n m·∫°ng (m·ªçi ng∆∞·ªùi xem ƒë∆∞·ª£c ngay):</p>
                    <ul>
                        <li>üëâ B·∫•m v√†o n√∫t ƒë√°m m√¢y ‚òÅÔ∏è ·ªü g√≥c tr√™n b√™n ph·∫£i.</li>
                        <li>üëâ Nh·∫≠p <strong>Token</strong> v√† <strong>Repository</strong> (Xem h∆∞·ªõng d·∫´n chi ti·∫øt trong
                            file <code>HUONG_DAN_GITHUB_SYNC.md</code>).</li>
                        <li>üëâ T·ª´ gi·ªù, m·ªói l·∫ßn b·∫•m <strong>L∆∞u</strong>, d·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông ƒë·∫©y l√™n m·∫°ng.</li>
                    </ul>
                </section>

                <section>
                    <h3>B∆∞·ªõc 5: XEM T·ªîNG K·∫æT üìä</h3>
                    <p>K√©o xu·ªëng d∆∞·ªõi c√πng trang web, anh/ch·ªã s·∫Ω th·∫•y b·∫£ng t·ªïng h·ª£p:</p>
                    <ul>
                        <li><strong>M√†u xanh:</strong> T·ªïng gi·ªù l√†m b√¨nh th∆∞·ªùng.</li>
                        <li><strong>M√†u v√†ng:</strong> T·ªïng gi·ªù l√†m th√™m (ƒë√£ nh√¢n h·ªá s·ªë).</li>
                        <li><strong>T·ªïng c·ªông th·ª±c nh·∫≠n:</strong> L√† t·ªïng t·∫•t c·∫£ gi·ªù c√¥ng c·ªßa anh/ch·ªã.</li>
                    </ul>
                </section>

                <section>
                    <h3>C·∫¶N GI√öP ƒê·ª†? üìû</h3>
                    <p>N·∫øu anh/ch·ªã g·∫∑p kh√≥ khƒÉn, h√£y g·ªçi ngay cho em T√¢n nh√©:</p>
                    <p>üëâ <strong>SƒêT/Zalo:</strong> 036.728.7102 (T√¢n Nguy·ªÖn)</p>
                </section>
            </div>
        </div>

        <!-- History Modal -->
        <div id="history-modal" class="modal">
            <div class="modal-content history-modal-content">
                <div class="modal-header">
                    <h2>L·ªäCH S·ª¨ CH·ªàNH S·ª¨A</h2>
                    <button class="close-modal-btn" onclick="hideHistoryModal()">‚úï</button>
                </div>
                <div class="history-employee-info">
                    T√™n: <span id="history-employee-name">...</span>
                </div>
                <div class="history-list-container">
                    <ul id="history-list" class="history-list">
                        <!-- History items will be injected here -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Login Modal -->
        <div id="login-modal" class="modal">
            <div class="modal-content">
                <h2>ƒêƒÉng nh·∫≠p h·ªá th·ªëng</h2>
                <p class="modal-subtitle">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</p>
                <div class="form-group">
                    <label>T√™n ƒëƒÉng nh·∫≠p:</label>
                    <input type="text" id="login-username" placeholder="T√™n (VD: T√ÇN) ho·∫∑c ƒê·ª¶ H·ªå T√äN n·∫øu tr√πng..."
                        autocomplete="username">
                </div>
                <div class="form-group">
                    <label>M·∫≠t kh·∫©u:</label>
                    <input type="password" id="login-password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u"
                        autocomplete="current-password">
                </div>
                <div class="modal-actions">
                    <button id="login-submit-btn" class="btn btn-save">ƒêƒÉng nh·∫≠p</button>
                </div>
                <p class="login-hint">ID: T√äN vi·∫øt HOA (Tr√πng t√™n: ƒê·ª¶ H·ªå T√äN C√ì D·∫§U) | MK: 123456</p>
            </div>
        </div>

        <!-- GitHub Config Modal -->
        <div id="github-config-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚öôÔ∏è C·∫•u h√¨nh ƒë·ªìng b·ªô GitHub</h2>
                    <button class="close-modal-btn" onclick="hideGitHubConfigModal()">‚úï</button>
                </div>

                <div class="github-config-content">
                    <div class="info-box">
                        <p><strong>üìå L∆∞u √Ω:</strong> D·ªØ li·ªáu s·∫Ω t·ª± ƒë·ªông ƒë·ªìng b·ªô l√™n GitHub sau m·ªói l·∫ßn l∆∞u, gi√∫p m·ªçi
                            ng∆∞·ªùi c√≥ th·ªÉ xem ngay.</p>
                    </div>

                    <div class="form-group">
                        <label>GitHub Personal Access Token: <span class="required">*</span></label>
                        <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                            autocomplete="off">
                        <small class="help-text">T·∫°o token t·∫°i: <a href="https://github.com/settings/tokens"
                                target="_blank">github.com/settings/tokens</a> (c·∫ßn quy·ªÅn <code>repo</code>)</small>
                    </div>

                    <div class="form-group">
                        <label>Repository: <span class="required">*</span></label>
                        <input type="text" id="github-repo" placeholder="username/repo-name" autocomplete="off">
                        <small class="help-text">V√≠ d·ª•: <code>tannguyen/cham-cong-data</code></small>
                    </div>

                    <div class="form-group">
                        <label>Branch:</label>
                        <input type="text" id="github-branch" value="main" placeholder="main">
                    </div>

                    <div class="form-group checkbox-group">
                        <label>
                            <input type="checkbox" id="github-auto-sync" checked>
                            T·ª± ƒë·ªông ƒë·ªìng b·ªô sau m·ªói l·∫ßn l∆∞u
                        </label>
                    </div>

                    <div id="github-status-message" class="status-message"></div>
                </div>

                <div class="modal-actions">
                    <button id="github-test-btn" class="btn btn-print">üîç Ki·ªÉm tra k·∫øt n·ªëi</button>
                    <button id="github-save-config-btn" class="btn btn-save">üíæ L∆∞u c·∫•u h√¨nh</button>
                    <button id="github-sync-now-btn" class="btn btn-export">‚òÅÔ∏è ƒê·ªìng b·ªô ngay</button>
                    <button id="github-restore-btn" class="btn btn-restore">üì• Kh√¥i ph·ª•c t·ª´ GitHub</button>
                </div>
            </div>
        </div>
    </div>
    <script src="github-sync.js"></script>
    <script src="app.js"></script>
</body>

</html>